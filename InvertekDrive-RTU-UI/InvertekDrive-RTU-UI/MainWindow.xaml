<Window x:Class="InvertekDrive_RTU_UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:styles="clr-namespace:InvertekDrive_RTU_UI.Assets.Styles"
        mc:Ignorable="d"
        Title="Invertek Drive Controller - Modbus RTU"
        Icon="Assets/Icons/electric-motor.ico"
        Height="800" Width="1000"
        RenderOptions.BitmapScalingMode="HighQuality"
        SizeToContent="WidthAndHeight"
        ResizeMode="CanMinimize,NoResize"
        WindowStartupLocation="CenterScreen"
        Background="#F0F0F0">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Connection Settings -->
            <GroupBox Grid.Row="0" Header="Modbus RTU Connection">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="150" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="150" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="120" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Label Grid.Column="0" Content="COM Port:" Margin="5,0" />
                    <ComboBox Grid.Column="1" Margin="5,0" ItemsSource="{Binding ComPorts}"
                              Text="{Binding SelectedComPort}" />

                    <Label Grid.Column="2" Content="Baud Rate:" Margin="5,0" />
                    <ComboBox Grid.Column="3" Margin="5,0"
                              ItemsSource="{Binding BaudRate}"
                              Text="{Binding SelectedBaudRate}" />

                    <Label Grid.Column="4" Content="Slave ID:" Margin="5,0" />
                    <TextBox Grid.Column="5" Text="{Binding SelectedSlaveId}" Margin="5,0" />

                    <Button Grid.Column="7" Content="Connect"
                            Style="{StaticResource ConnectButton}"
                            Command="{Binding ConnectModbusDevice}" />
                    <Button Grid.Column="8" Content="Disconnect"
                            Style="{StaticResource DisconnectButton}"
                            Command="{Binding DisconnectModbusDevice}" />
                    <Button Grid.Column="9" Content="Port Refresh"
                            Style="{StaticResource PortRefresh}"
                            Command="{Binding UpdateLocalPorts}" />
                </Grid>
            </GroupBox>

            <!-- Status Display -->
            <GroupBox Grid.Row="1" Header="Drive Status">
                <StackPanel>
                    <Grid Margin="0,10,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- Speed Status -->
                        <Border Grid.Column="0" Style="{StaticResource StatusCard}">
                            <StackPanel>
                                <TextBlock Text="CURRENT SPEED" FontSize="11" Foreground="#666"
                                           FontWeight="Normal" Margin="0,0,0,5" />
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding CurrentRpm, StringFormat={}{0:F0}}"
                                               FontSize="24"
                                               FontWeight="Bold" Foreground="#2C3E50" />
                                    <TextBlock Text=" RPM" FontSize="14" Foreground="#7F8C8D"
                                               VerticalAlignment="Bottom" Margin="5,0,0,2" />
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Frequency Status -->
                        <Border Grid.Column="1" Style="{StaticResource StatusCard}">
                            <StackPanel>
                                <TextBlock Text="OUTPUT FREQUENCY" FontSize="11" Foreground="#666"
                                           FontWeight="Normal" Margin="0,0,0,5" />
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock
                                        Text="{Binding OutFrequency, 
                                StringFormat={}{0:F1}}"
                                        FontSize="24"
                                        FontWeight="Bold" Foreground="#2C3E50" />
                                    <TextBlock Text=" Hz" FontSize="14" Foreground="#7F8C8D"
                                               VerticalAlignment="Bottom" Margin="5,0,0,2" />
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Current Status -->
                        <Border Grid.Column="2" Style="{StaticResource StatusCard}">
                            <StackPanel>
                                <TextBlock Text="MOTOR CURRENT" FontSize="11" Foreground="#666"
                                           FontWeight="Normal" Margin="0,0,0,5" />
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock
                                        Text="{Binding OutCurrent, StringFormat={}{0:F1}}" FontSize="24"
                                        FontWeight="Bold" Foreground="#2C3E50" />
                                    <TextBlock Text=" A" FontSize="14" Foreground="#7F8C8D"
                                               VerticalAlignment="Bottom" Margin="5,0,0,2" />
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Voltage Status -->
                        <Border Grid.Column="3" Style="{StaticResource StatusCard}">
                            <StackPanel>
                                <TextBlock Text="DC BUS VOLTAGE" FontSize="11" Foreground="#666"
                                           FontWeight="Normal" Margin="0,0,0,5" />
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding DcBusVolt}" FontSize="24"
                                               FontWeight="Bold" Foreground="#2C3E50" />
                                    <TextBlock Text=" V" FontSize="14" Foreground="#7F8C8D"
                                               VerticalAlignment="Bottom" Margin="5,0,0,2" />
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </Grid>


                    <!-- Status Indicator -->
                    <StackPanel Orientation="Horizontal" Margin="10,15,0,5">
                        <!-- Modbus Status Indicator -->
                        <Ellipse Width="14" Height="14"
                                 Fill="{Binding ModbusConnected, Converter={StaticResource BoolToColorConverter}}"
                                 Margin="0,0,10,0">
                            <Ellipse.Effect>
                                <DropShadowEffect Color="#27AE60" ShadowDepth="0" BlurRadius="8" />
                            </Ellipse.Effect>
                        </Ellipse>
                        <TextBlock FontSize="14" FontWeight="Normal">
                            <Run Text="Modbus Status:" Foreground="#333" />
                            <Run Text="{Binding ModbusConnectionStatus, Mode=OneWay}"
                                 FontWeight="SemiBold"
                                 Foreground="#2C3E50" />
                        </TextBlock>
                        <!-- Drive Status Indicator -->
                        <Ellipse Width="14" Height="14"
                                 Fill="{Binding RunningStatus, Converter={StaticResource BoolToColorConverter}}"
                                 Margin="50,0,10,0">
                            <Ellipse.Effect>
                                <DropShadowEffect Color="#27AE60" ShadowDepth="0" BlurRadius="8" />
                            </Ellipse.Effect>
                        </Ellipse>
                        <TextBlock FontSize="14" FontWeight="Normal">
                            <Run Text="Drive Status:" Foreground="#333" />
                            <Run Text="{Binding CurrentlyDriveStatus, Mode=OneWay}" FontWeight="SemiBold"
                                 Foreground="#2C3E50" />
                        </TextBlock>

                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Main Control Area -->
            <Grid Grid.Row="2" Margin="10,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Control Panel -->
                <GroupBox Grid.Column="0" Header="Drive Control" IsEnabled="{Binding ModbusConnected}">
                    <StackPanel>
                        <!-- Control Buttons -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <Button Grid.Row="0" Grid.Column="0"
                                    Content="▶ START" Style="{StaticResource StartButton}"
                                    Command="{Binding ChangeToRunDrive}" />
                            <Button Grid.Row="0" Grid.Column="1"
                                    Content="■ STOP" Style="{StaticResource StopButton}"
                                    Command="{Binding ChangeToStopDrive}" />

                            <Button Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                    Content="⟳ RESET FAULT"
                                    Style="{StaticResource ResetButton}"
                                    Command="{Binding ResetDrive}" />
                        </Grid>

                        <!-- Speed Control -->
                        <StackPanel Margin="0,70,0,0">
                            <Label Content="Speed Setpoint" FontWeight="SemiBold" FontSize="14" />

                            <TextBlock Text="{Binding SetFrequencyValue, StringFormat={}{0:F1}}"
                                       FontSize="36"
                                       FontWeight="Bold" HorizontalAlignment="Center"
                                       Foreground="#2C3E50" Margin="0,10,0,0">
                                <TextBlock.Effect>
                                    <DropShadowEffect ShadowDepth="1" BlurRadius="2" Opacity="0.3" />
                                </TextBlock.Effect>
                            </TextBlock>
                            <TextBlock Text="Hz" FontSize="16" Foreground="#7F8C8D"
                                       HorizontalAlignment="Center" Margin="0,-5,0,10" />

                            <Slider Minimum="0" Maximum="{Binding SliderMaxValue}"
                                    Value="{Binding SetFrequencyValue,UpdateSourceTrigger=PropertyChanged}"
                                    TickFrequency="0.1" IsSnapToTickEnabled="True"
                                    TickPlacement="BottomRight" Margin="10,10,10,5" />

                            <Grid Margin="10,5,10,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="0 Hz" FontSize="12"
                                           Foreground="#666" HorizontalAlignment="Left" />
                                <TextBlock Grid.Column="1"
                                           Text="{Binding MidSliderValue, StringFormat='{}{0}Hz'}"
                                           FontSize="12"
                                           Foreground="#666" HorizontalAlignment="Center" />
                                <TextBlock Grid.Column="2"
                                           Text="{Binding SliderMaxValue, StringFormat='{}{0}Hz'}" FontSize="12"
                                           Foreground="#666" HorizontalAlignment="Right" />
                            </Grid>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>

                <!-- Parameters Panel -->
                <GroupBox Grid.Column="1" Header="Drive Parameters" IsEnabled="{Binding ModbusConnected}">
                    <StackPanel>
                        <!-- Acceleration Time -->
                        <Grid Margin="0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Label Grid.Column="0" Content="Acceleration Time (s):"
                                   VerticalAlignment="Center" />
                            <TextBox Grid.Column="1"
                                     Text="{Binding AccelerationTimeValue}"
                                     Margin="5,0">
                                <TextBox.ToolTip>
                                    <ToolTip Content="Range is 0.00s - 600s" />
                                </TextBox.ToolTip>
                            </TextBox>
                            <Button Grid.Column="2" Content="Write"
                                    Style="{StaticResource WriteButton}"
                                    Command="{Binding WriteAcceleration}" />
                        </Grid>

                        <!-- Deceleration Time -->
                        <Grid Margin="0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Label Grid.Column="0" Content="Deceleration Time (s):"
                                   VerticalAlignment="Center" />
                            <TextBox Grid.Column="1" Text="{Binding DecelerationTimeValue}"
                                     Margin="5,0">
                                <TextBox.ToolTip>
                                    <ToolTip Content="Range is 0.00s - 600s" />
                                </TextBox.ToolTip>
                            </TextBox>
                            <Button Grid.Column="2" Content="Write"
                                    Style="{StaticResource WriteButton}"
                                    Command="{Binding WriteDeceleration}" />
                        </Grid>

                        <!-- Max Frequency -->
                        <Grid Margin="0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Label Grid.Column="0" Content="Max Speed (RPM):"
                                   VerticalAlignment="Center" />
                            <TextBox Grid.Column="1" Text="{Binding MaxSpeedValue}"
                                     Margin="5,0">
                                <TextBox.ToolTip>
                                    <ToolTip Content="3600RPM = 60Hz - 3000RPM = 50Hz" />
                                </TextBox.ToolTip>
                            </TextBox>
                            <Button Grid.Column="2" Content="Write"
                                    Style="{StaticResource WriteButton}"
                                    Command="{Binding WriteMaxSpeed}" />
                        </Grid>

                        <!-- Min Frequency -->
                        <Grid Margin="0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Label Grid.Column="0" Content="Min Speed (RPM):"
                                   VerticalAlignment="Center" />
                            <TextBox Grid.Column="1" Text="{Binding MinSpeedValue}"
                                     Margin="5,0">
                                <TextBox.ToolTip>
                                    <ToolTip Content="Range is 0 - 2999 RPM" />
                                </TextBox.ToolTip>
                            </TextBox>
                            <Button Grid.Column="2" Content="Write"
                                    Style="{StaticResource WriteButton}"
                                    Command="{Binding WriteMinSpeed}" />
                        </Grid>

                        <!-- Motor Rated Current -->
                        <Grid Margin="0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Label Grid.Column="0" Content="Motor Rated Current (A):"
                                   VerticalAlignment="Center" />
                            <TextBox Grid.Column="1" Text="{Binding MotorRatedCurrentValue}"
                                     Margin="5,0">
                                <TextBox.ToolTip>
                                    <ToolTip Content="Range is 2.6 - 10.5 A" />
                                </TextBox.ToolTip>
                            </TextBox>
                            <Button Grid.Column="2" Content="Write"
                                    Style="{StaticResource WriteButton}"
                                    Command="{Binding WriteMotorRatedCurrent}" />
                        </Grid>
                        <!-- Motor Rated Voltage -->
                        <Grid Margin="0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Label Grid.Column="0" Content="Motor Rated Voltage (V):"
                                   VerticalAlignment="Center" />
                            <TextBox Grid.Column="1" Text="{Binding MotorRatedVoltValue}"
                                     Margin="5,0">
                                <TextBox.ToolTip>
                                    <ToolTip Content="Range is 20 - 120 V" />
                                </TextBox.ToolTip>
                            </TextBox>
                            <Button Grid.Column="2" Content="Write"
                                    Style="{StaticResource WriteButton}"
                                    Command="{Binding WriteMotorRatedVolt}" />
                        </Grid>
                        <!-- Motor Rated Frequency -->
                        <Grid Margin="0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Label Grid.Column="0" Content="Motor Rated Frequency (Hz):"
                                   VerticalAlignment="Center" />
                            <TextBox Grid.Column="1" Text="{Binding MotorRatedFrequencyValue}"
                                     Margin="5,0">
                                <TextBox.ToolTip>
                                    <ToolTip Content="50 or 60 Hz" />
                                </TextBox.ToolTip>
                            </TextBox>
                            <Button Grid.Column="2" Content="Write"
                                    Style="{StaticResource WriteButton}"
                                    Command="{Binding WriteMotorRatedFrequency}" />
                        </Grid>
                    </StackPanel>
                </GroupBox>
            </Grid>

            <!-- Communication Log -->
            <!-- <GroupBox Grid.Row="3" Header="Communication Log" Height="180"> -->
            <!--     <Grid> -->
            <!--         <Grid.RowDefinitions> -->
            <!--             <RowDefinition Height="*" /> -->
            <!--             <RowDefinition Height="Auto" /> -->
            <!--         </Grid.RowDefinitions> -->
            <!-- -->
            <!--         <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" -->
            <!--                       Background="#2C3E50"> -->
            <!--             <TextBlock x:Name="txtLog" TextWrapping="Wrap" Padding="10" -->
            <!--                        FontFamily="Consolas" FontSize="12" Foreground="#ECF0F1" /> -->
            <!--         </ScrollViewer> -->
            <!-- -->
            <!--         <Button Grid.Row="1" Content="Clear Log" HorizontalAlignment="Right" -->
            <!--                 Margin="5" Padding="10,5" -->
            <!--                 Background="#95A5A6" Foreground="White" BorderThickness="0" /> -->
            <!--     </Grid> -->
            <!-- </GroupBox> -->
            <Image Grid.Row="4" Source="Assets/Icons/horizontallogo.png" Stretch="Fill" HorizontalAlignment="Center"
                   VerticalAlignment="Center" Width="200" Height="60" Margin="0,0,0,10" />
        </Grid>
    </ScrollViewer>
</Window>